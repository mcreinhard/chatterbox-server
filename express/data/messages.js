// Generated by CoffeeScript 1.7.1
(function() {
  var data, messages, _;

  _ = require('underscore');

  messages = {};

  data = [
    {
      username: 'me',
      text: 'foo',
      roomname: 'room',
      createdAt: '2014-05-06T18:55:59.131Z'
    }
  ];

  messages.add = function(message) {
    var key, _i, _len, _ref;
    console.log(message);
    _ref = ['username', 'text', 'roomname'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      if (message[key] == null) {
        message[key] = '';
      }
    }
    message.createdAt = (new Date()).toJSON();
    return data.push(message);
  };

  messages.get = function(options) {
    var filter, key, sort, val, _ref;
    console.log(options);
    if ((options != null ? options.filter : void 0) != null) {
      _ref = options.filter, key = _ref[0], val = _ref[1];
      filter = function(list) {
        return _(list).filter((function(x) {
          return x[key] === val;
        }));
      };
    } else {
      filter = _.identity;
    }
    if ((options != null ? options.order : void 0) != null) {
      if (options.order[0] === '-') {
        sort = function(list) {
          return (_(list).sortBy(options.order.slice(1))).reverse();
        };
      } else {
        sort = function(list) {
          return _(list).sortBy(options.order);
        };
      }
    } else {
      sort = _.identity;
    }
    return filter(sort(data));
  };

  module.exports = messages;

}).call(this);
